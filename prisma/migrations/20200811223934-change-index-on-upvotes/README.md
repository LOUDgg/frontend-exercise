# Migration `20200811223934-change-index-on-upvotes`

This migration has been generated by Pierre Ortega at 8/11/2020, 3:39:34 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
PRAGMA foreign_keys=OFF;

CREATE TABLE "new_Upvotes" (
"opinion_id" INTEGER NOT NULL,
"user_id" TEXT NOT NULL,
PRIMARY KEY ("opinion_id","user_id"),
FOREIGN KEY ("opinion_id") REFERENCES "Opinions"("id") ON DELETE CASCADE ON UPDATE CASCADE,

FOREIGN KEY ("user_id") REFERENCES "Users"("id") ON DELETE CASCADE ON UPDATE CASCADE
)

INSERT INTO "new_Upvotes" ("opinion_id", "user_id") SELECT "opinion_id", "user_id" FROM "Upvotes"

PRAGMA foreign_keys=off;
DROP TABLE "Upvotes";;
PRAGMA foreign_keys=on

ALTER TABLE "new_Upvotes" RENAME TO "Upvotes";

PRAGMA foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200811215236-make-email-and-username-unique..20200811223934-change-index-on-upvotes
--- datamodel.dml
+++ datamodel.dml
@@ -2,9 +2,9 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource sqlite {
   provider = "sqlite"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -20,13 +20,14 @@
   user_id   String
 }
 model Upvotes {
-  id         Int      @default(autoincrement()) @id
   opinion    Opinions @relation(fields: [opinion_id], references: [id])
   opinion_id Int
-  user       Users?   @relation(fields: [user_id], references: [id])
-  user_id    String?
+  user       Users    @relation(fields: [user_id], references: [id])
+  user_id    String
+
+  @@id([opinion_id, user_id])
 }
 model Users {
   id       String     @default(uuid()) @id
```


